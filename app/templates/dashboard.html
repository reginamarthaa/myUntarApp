{% extends "base.html" %}

{% block content %}
<div class="container has-text-center">
    <h1 class="title">
        Welcome, {{ email }}
    </h1>
    <div class="row">
        <div class="col-md-5">
            <label class="text-center">Hasil identifikasi intensi Mahasiswa Untar terhadap Technopreneurship</label>
            <!-- <img src="{{ chart_image }}" alt="Pie Chart"> -->
            <div id="piechart_3d" style="width: 400px; height: 400px;"></div>
             <!-- <canvas id="myChart" width="400" height="400"> -->

             </canvas>
        </div>
        <div class="col-md-7">
            <h2>Pilih Pertanyaan:</h2>
        <select class="form-control" id="questionSelect" onchange="">
            <option value="1">Pertanyaan 1</option>
            <option value="2">Pertanyaan 2</option>
            <option value="3">Pertanyaan 3</option>
            <option value="4">Pertanyaan 4</option>
            <option value="5">Pertanyaan 5</option>
        </select>

        <div id="chart_div" class="mt-4"></div>
        </div>
    </div>
</div>


<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript"> 
    google.charts.load("current", {packages:["corechart"]});
      google.charts.setOnLoadCallback(drawPieChart);
      google.charts.setOnLoadCallback(drawLineChart);
      function drawPieChart() {
        var data_hasil = google.visualization.arrayToDataTable([
            {% for key, value in data_hasil.items() %}
                {% if value is string %}
                    ['{{ key }}', '{{ value }}'],
                {% else %}
                    ['{{ key }}', {{ value }}],
                {% endif %}
            {% endfor %}
        ]);
 
        var options = {
          is3D: true,
          //pieHole: 0.5
          pieStartAngle: 100
          /*slices: {  
            2: {offset: 0.2},
            3: {offset: 0.3}
          }*/
          /*slices: {
            1: { color: 'transparent' }
          }*/
        };
 
        var chart = new google.visualization.PieChart(document.getElementById('piechart_3d'));
        chart.draw(data_hasil, options);
      }

      function drawLineChart(dataArray) {
            const data_pertanyaan = google.visualization.arrayToDataTable([
                ['X', 'Value'],
                ...dataArray.map((value, index) => [index + 1, value])
            ]);

            const options = {
                title: 'Line Chart',
                curveType: 'function',
                legend: { position: 'bottom' }
            };

            const chart = new google.visualization.LineChart(document.getElementById('chart_div'));
            chart.draw(data_pertanyaan, options);
        }

        function updateChart(questionId) {
            fetch(`/get_data/${questionId}`)
                .then(response => response.json())
                .then(data_pertanyaan => drawChart(data_pertanyaan));
        }

        window.onload = function() {
            updateChart(1);  // Menampilkan chart untuk pertanyaan 1 saat pertama kali
        };
</script> 
{% endblock %}